## **L4 부하분산과 무정지 시스템의 원리와 구현 방식**

  인터넷 환경에서 수많은 사용자 요청을 처리하는 웹 서비스는 단일 서버로는 감당하기 어렵다. 이런 문제를 해결하기 위해 도입되는 개념이 바로 **부하분산(Load Balancing)** 이다. 특히 **L4 스위치 기반의 부하분산**은 TCP/UDP 포트 정보를 기반으로 요청을 여러 서버로 나누는 방식으로, 효율적인 리소스 사용과 안정적인 서비스 제공에 핵심적인 역할을 한다.

## **L4 스위치의 작동 방식: NAT와 유사한 흐름**

우리가 흔히 사용하는 공유기는 NAT(Network Address Translation)를 통해 사설 IP와 공인 IP를 변환해준다. 이때 포트 정보도 함께 변환되는데, 이는 TCP/UDP 기반의 전송 계층, 즉 L4 수준에서 이루어진다. 이러한 방식은 **L4 스위치**의 작동 원리와 매우 유사하다.
- 사용자는 도메인 주소(ex. www.abc.com)를 입력하면 DNS를 통해 IP를 전달받는다.
    
- 모든 사용자는 동일한 공인 IP(ex. 15.15.15.15)에 HTTP 요청을 보낸다.
    
- 하지만 실제로 그 IP 뒤에는 **다수의 웹 서버**가 존재하며, L4 스위치는 사용자의 요청을 이 서버들 중 하나로 **포트 기반으로 포워딩**한다.
    
- 이때 각 서버는 **동일한 콘텐츠를 제공**하며, 어디로 연결되든 사용자 입장에서는 동일한 결과를 받는다.


## **단순 부하분산: 라운드로빈(Round Robin)**

가장 단순한 형태의 부하분산은 **라운드로빈 방식**이다. 사용자의 접속 순서대로 서버에 분배하는 것으로, 예를 들어 첫 번째 요청은 서버 1번, 두 번째 요청은 서버 2번… 이런 식으로 순환한다.

하지만 이 방식은 서버 상태를 고려하지 않기 때문에 다음과 같은 단점이 있다:

- 서버가 과부하 상태여도 무작정 요청이 배정됨
    
- 비정상 서버도 계속 스케줄링될 수 있음
    
## **제대로 된 부하분산의 핵심: 헬스 체크(Health Check)**

안정적인 부하분산을 위해선 반드시 **헬스 체크**가 포함되어야 한다. 이는 각 서버의 상태를 지속적으로 점검하여, 요청을 정상적인 서버에만 보내도록 조정하는 것이다.

### **헬스 체크를 위한 구성 요소**

- **매니저 서버(또는 로드밸런서)**: 서버들의 상태를 실시간으로 모니터링
- **점검 지표**:
    - CPU 사용률
        
    - 메모리 사용량
        
    - 디스크 여유 공간 등
- 일정 수준 이상의 부하가 감지되면 해당 서버는 **스케줄링에서 제외**된다.
  
## **무정지 시스템(Fault Tolerant System)**

서버 하나에 장애가 나더라도 전체 시스템이 멈추지 않는 구조를 **무정지 시스템**이라고 한다. 이를 위해 다양한 이중화 전략이 활용된다.

### **L4 스위치 자체의 이중화**

로드밸런서 자체도 장애 가능성이 있기 때문에 보통 다음과 같은 구조를 가진다:

- 로드밸런서를 **2대 구성** (Active-Standby 또는 Active-Active)
    
- **가상 IP(Virtual IP)** 또는 **가상 MAC(Virtual MAC)** 주소로 외부에 하나의 장비처럼 인식
    
- 한 장비가 다운되면 다른 장비가 자동으로 서비스 대체
  

### **서버의 가상화와 DevOps**

요즘은 물리 서버 대신 **가상 머신**이나 **컨테이너(Docker)** 형태로 웹 서버를 운영한다. 이 방식은 다음과 같은 장점을 제공한다:

- 서버 장애 시 A/S 없이 스냅샷 복원으로 빠른 복구 가능
    
- 새로운 서버 배포도 자동화 가능
    
- Kubernetes 등의 오케스트레이션 도구로 전체 시스템 관리


## **클라우드 시대의 부하분산**

이제 로드밸런서, 서버, 네트워크 스위치조차도 가상화되고 있다. 모든 인프라가 클라우드 환경에서 제공되며, 사용자는 서비스만 설계하면 되고, **장애 대응, 확장성, 유지보수**는 클라우드 제공자가 책임지는 시대다.

이로 인해 **DevOps** 문화가 확산되고 있으며, 개발과 운영이 통합되어 서비스 품질 향상이 가능해졌다.


![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdX3bye%2FbtslgiGEyiy%2FXzyMCPHToEOqwo8wncEaN0%2Fimg.png)

---

## **GSLB(Global Server Load Balancing)**

### **L4 부하분산에서 GSLB로의 확장**

L4 스위치를 기반으로 하는 부하분산은 기본적으로 **하나의 서비스 주소(IP)** 에 여러 서버가 숨겨져 있고, 요청이 들어오면 로드밸런서가 이를 적절한 서버로 분산하는 방식이다. 하지만 이 방식은 **단일 데이터센터 수준에서의 분산**일 뿐, 지리적 거리가 있는 사용자에게는 한계가 있다.

- 서울에만 있는 서버에 일본, 미국, 유럽 사용자까지 몰리게 되면 **속도 저하**와 **지연(latency)** 문제가 발생한다.
    
- 이때, 단순한 L4 수준의 분산으로는 한계가 있다.

### **GSLB란 무엇인가?**

GSLB는 이러한 한계를 극복하기 위한 기술로, **지리적으로 분산된 여러 서버에 트래픽을 분산**하는 방식이다. 단순히 부하만 고려하는 것이 아니라, **사용자의 위치, ISP, 네트워크 상태**까지 고려해서 가장 적합한 서버로 연결시킨다.

#### **GSLB의 핵심 구성 요소**

1. **DNS 기반 분산 처리**
    
    - GSLB는 주로 DNS 응답에 의해 트래픽을 분산시킨다.
        
    - 사용자가 www.abc.com에 접속 요청을 보내면, DNS는 지역별로 적합한 서버 주소를 응답해준다.
        
    - 이때, **Canonical Name (CNAME)** 방식으로 지역별 서버 도메인으로 리다이렉트 된다.
        
    
2. **지리적 위치 기반 라우팅**
    
    - 사용자 IP 주소를 기반으로 **국가, 도시, ISP** 수준의 위치 정보를 파악한다.
        
    - 이를 위해 MaxMind 같은 위치 데이터베이스를 활용한다.
        
    - 예: 한국에서 접속한 사용자는 한국에 위치한 서버로, 일본 사용자에게는 일본 서버로 연결.
        
    
3. **ISP 기반 최적화**
    
    - 특정 ISP 내부에 위치한 서버로 연결하면 망 내 트래픽만 발생하므로, 응답 속도가 매우 빨라진다.
        
    - KT, SK브로드밴드, LG U+ 사용자 각각에게 최적의 서버를 배정 가능.
        
    
4. **CDN(Content Delivery Network)과의 통합**
    
    - 글로벌 서버 간 콘텐츠를 동일하게 유지하는 게 중요하다.
        
    - 이를 위해 CDN을 사용하면 콘텐츠를 한 번 업로드하여 전 세계 서버에 자동으로 동기화할 수 있다.
        
    - 예: 아카마이(Akamai), 클라우드플레어(Cloudflare) 등.


![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcwoJCJ%2FbtslpVYnaQJ%2FCgLgfMt11aUBTo27yPoeH1%2Fimg.png)

### **GSLB의 작동 방식 요약**

1. 사용자가 도메인 접속 요청 → DNS에 질의
    
2. DNS는 CNAME 방식으로 해당 지역 서버 도메인 반환
    
3. 사용자 브라우저가 해당 도메인의 IP 질의 → 지역 최적 서버로 연결
    
4. 서버는 사용자의 요청 처리 → 최적의 성능 제공

### **실제 예시: 네이버의 GSLB 구조**

- nslookup naver.com 명령을 실행해 보면, 실제 IP가 아닌 다른 CDN 주소(*.akamai.net)로 리턴되는 경우가 많다.
    
- 이는 네이버가 GSLB 및 CDN을 이용해, 사용자 위치에 따라 자동으로 최적 서버를 배정하고 있음을 보여준다.
    

### **GSLB의 장점**

- **속도 향상**: 사용자와 가까운 서버로 연결되기 때문에 지연 최소화
    
- **장애 분산**: 특정 지역 서버가 장애나도 다른 서버로 우회 가능
    
- **유지보수 효율성**: 서버 업데이트 시 CDN으로 동기화 가능
    
- **확장성 확보**: 글로벌 트래픽 급증에도 탄력적으로 대응 가능

### **트렌드: GSLB + 클라우드 + 가상화**

최근에는 이러한 GSLB 시스템이 전부 **클라우드 환경에서 가상화**되어 운영되고 있다. 예전처럼 서버, L4 스위치, 로드밸런서를 물리적으로 다 구성하는 것이 아니라:

- 클라우드에서 로드밸런서 서비스 (ex. AWS Route 53, GCP Cloud DNS)
    
- 컨테이너 환경에서 서비스 배포 (ex. Docker, Kubernetes)
    
- 콘텐츠는 CDN으로 자동 배포
    
- 모든 인프라 운영은 **클라우드 사업자에게 위임**