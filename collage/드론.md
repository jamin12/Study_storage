## Dronecode 소프트웨어 구조
- 고급 제어(비디오,충돌 회피)
- APIs
- 비행제어(FC)
- 펌웨어:SiK 라디오, 센서, 속도제어, 안테나
- 기체외부요소 : 시뮬레이터, GCS, 기체
- 드론코드 프로젝트는 기존의 오픈소스 드론 프로젝트와 그 자산을 리눅스 재단의 비영리 구조에 편입시킬 예정이며, 무인항공기(Unmanned Aerial Vehicles, UAVs)를 위한 이 프로젝트의 결과는 오픈소스 플랫폼으로 공유한다.


## 개발용 자율 드론 핵심 기능
- Open Source Project
- Easy to Build and Set up
- Telemetry Support
- Auto Take-off and Landing
- Waypoint
- Follow me Function
- Remote Monitoring
- Support many types of UAVs

## 드론의 구성
- 기체 프레임
- FC(Flight Controller) 하드웨어
- FC 소프트웨어
- 통신방식 및 통신프로토콜(MAVlink)
- GCS(Ground Control Station) 소프트웨어

## 드론의 활용 분야
- 국외 :  다양한 서비스에 활용(범죄 예방, 운송, 재난 감시,군사 목적 등등)
- 국내 : 레크레이션용, 개인용/방송용, 농업, 산림감시  

## 드론 용어
1. 바인딩(Binding) = 조종기와 드론 연결
   - 블루투스로 스마트폰과 헤드셋을 연결하는 것처럼 조종기와 드론을 연결할때를 바이딩이라고 한다. 기본적으로 조종기와 드론이 1:1로 연결되는경우도 있지만, 일부 조종기는 여러 대의 드론과 연결 설정을 저장한 뒤선택해서 연결할 수 있다.
   - 바인딩을 하는 방법은 각 제조사, 모델별로 다르다.
   - 대부분 바인딩은 드론에 전원을 켠 뒤 조종기의 전원을 넣고 조종기 컨트롤러를 특정하게 조작해서 진행한다. 드론과 거리가 멀어지면 연결이 풀어져 조종이 불가하기 하기 때문에 제조사에서 권고하는 거리 내에서 조작을 해야 한다. 
2. 주파수 :
   - 주파수는 무선조종기에서 드론을 조작하기 위해 발생하는 신호 구간이다.,대체로 2.4GHz, 5.8Ghz 사용
3. 채널  = 무선조종 신호를 인식할 수 있는 수
   - 채널은 드론이 움직일 수 있는 방향을 명령하는 신호를 인식할 수 있는 수를 나타낸다. 전후좌우, 상하회전이 필요한 드론은 대부분 4채널, 6채널로 구분되는데, 최근에는 입문 모델도 6채널을 지원하고 있다. 4채널은 상하(1채널), 좌우(1채널), 기울기(1채널), 전후진(1채널) 이렇게 4개의 채널을 사용한다.
4. 자이로 센서(Gyro sensor) = 기울기, 가속도 측정 센서
   - 자이로센서는 지표면을 중심으로 기울기, 가속도 등을 측정할 수 있는 센서이다. 이 센서를 통해 드론은 자세나 위치를 추정해 비행을 보정 할 수 있다.
   - 대부분의 드론에 탑재되는 자이로 센서는 3축 가속도, 3축 각속도를 파악해 드론의 현재 위치를 파악해 기울어지지 않게 만들어 준다. 기체의 수평 안정성을 유지해 주기 때문에 안정적인 비행을 할 수 있게 해준다
5. 캘리브레이션(Calibration) = 드론과 무선 조종기의 재설정
   - 캘리브레이션은 드론과 무선조종기 기준을 다시 설정하는 작업이다.
   - 대부분 일정 횟수로 비행을 하면 지자기 센서와 무선조종기 간 오차가 발생하기 때문에 캘리브레이션을 주기적으로 해줘야 한다. 캘리브레이션 방법은 브랜드와 제품마다 다르기 때문에 제조사에서 제공하는 설명서나 홈페이지에 나와 있는 방법으로 조작해야 한다. 
6. 짐벌(Gimbal) = 물체의 기본틀이 기울어져도 균형을 유지해 주는 장치
   - 드론에서 짐벌은 몸체에 부착된 카메라의 떨림에 상관없이 안정적이고 부드러운 영상을 촬영하게 만들어주는 역할을 한다.
   - 짐벌이 없는 드론 경우 이동시 기체의 움직임과 진동이 카메라에 반영되어 떨리는 영상이 만들어 지는데, 짐벌이 없다면 뛰어가면서 영상을 촬영하는 것과 마찬가지이다.  
7. FPV(First-Person View) = 1인칭 시점
   - 드론 중에 FPV를 지원하는 제품이 있다. FPV는 드론에 장착된 카메라를 통해 원격으로 영상을 송출해 마치 자신이 드론에 탑승하고 있는 것처럼 즐길 수 있는 기능이다. PC게임 중 올펜슈타인, 둠, 크로스파이 등 1인칭 슈팅 게임(First-Person Shooter)를 생각하면 이해가 쉽게 될 것이다.
8. GPS
   - GPS(Global Positioning System)는 20,200km 상공에서 운영중인 미국의 GPS 위성을 이용하여 지상의 위치정보를 획득하는 시스템이다. 드론 위치정보 송수신
9. 호버링(Hovering) = 공중 정지 비행
   - 호버링은 헬리콥터가 공중에 정지해 있는 상태로 드론이 한곳에 떠서 정지해 있는 상태를 말한다. RC자동차 경우 땅에 붙어 있기 때문에 조작을 하지 않은 상태면 지면에 그대로 있지만, 드론의 경우 하늘에 떠 있어서 조작을 하지 않으면 추락하게 된다.
   - 호버링은 RC헬기나 드론 조작의 기본이라고 하는 이유는 대부분 전파간섭과 균형이 제대로 잡히지 않아 한쪽 방향으로 흐르기 때문이다.
## ROS구조
### __<span style="color:#ff9933">ROS 용어</span>__
- Node
  - 최소 단위의 실행 가능한 프로세스를 가리키는 용어로써 하나의 실행가능한 프로그램으로 생각하면 된다.
  - ROS에서는 최소한의 실행 단위로 프로그램을 나누어 작업하게 된다. 각노드는 메시지통신으로 데이터를 주고 받는다.
  - 노드는 생성과 함께 마스터에 노드와 퍼블리셔, 서브스크라이버, 토픽, 서비스의 각 이름, 메시지 형태, URI 주소와 포트를 등록한다. 이 정보들을 기반으로 각 노드는 노드끼리 토픽과 서비스를 이용해 메시지를 주고 받는다.

- Package
  - 하나 이상의 노드, 노드 실행을 위한 정보 등을 묶어 놓은것. 또한, 패키지의 묶음을 메타 패키지라 하여 따로 분리한다.
  - 패키지 - ROS 기본단위이다. ROS Indigo는 2015.3.5 기준으로 1,600개 (www.ros.org/debbuild/indigo.html) 패키지를 제공하며, 사용자 개발 공개 패키지는 5,340개 (http://rosindex.github.io/stats/) 정도이다.

- Message
  - 메시지를 통해 노드간의 데이터를 주고 받게 된다. 메시지는 integer, floating point, boolean와 같은 변수 형태이다. 또한, 메시지 안에 메시지를 품고 있는 간단한 데이터 구조 및 메시지들의 배열과 같은 구조도 사용할 수 있다
  - 단방향 메시지 송수신 방식의 토픽과 양방향 메시지 요청/응답 방식의 서비스를 이용한다.
- 마스터(Master)
  - 노드와 노드 사이의 연결과 메시지 통신을 위한 네임 서버와 같은 역활을 한다. roscore가 실행 명령어이다. 실행하면, 각 노드의 이름을 등록하고, 필요에 따라 정보를 받을 수 있다. 
  - 마스터는 접속하는 슬래이브들과의 접속 상태를 유지하지 않는 HTTP 기반의 프로토콜인 XMLRPC를 이용하여 슬레이브들과 통신한다. 이로 인해, 슬레이브가 다운되더라도, 마스터는 다운되는 일이 없으며, 슬레이브의 센서 노드 등이 일부 종료하더라도, 전체 시스템이 다운되는 일은 없다. 심지어, 다운된 센서 노드가 다시 기동하면, 이 데이터를 받는 노드는 다시 데이터를 받아 처리하도록 되어 있다. 이는 토픽-메시지 기반 데이터 처리 방식이기 때문에 가능한 것이다. 
  - 마스터는 사용자가 정해 놓은 ROS_MASTER_URL변수에 기재된 URI주소와 포트를 가진다. 사용자가 설정해 놓지 않으면, URI주소로 현재 로컬 IP를 사용하고, 11311포트를 이용한다.
- __<span style="color:#ff9933">토픽(Topic)</span>__
  - 스토리이며, 퍼블리셔(publisher) 노드가 하나의 스토리에 대해, 토픽이란 이름으로 마스터에 등록한 후, 이 스토리에 대해 메시지 형태로 퍼블리쉬 한다.
  - 토픽을 수신받기 위해서, 서브스크라이버(subscriber) 노드가 마스터에 등록된 토픽의 이름에 해당하는 퍼블리셔 노드의 정보를 받는다. 이를 기반으로 서브스크라이버 노드와 퍼블리셔 노드가 직접 연결해 메시지를 토픽으로 송수신한다.
- 서비스
  - 동기화된 메시지 처리 방식이다. 일회성 메시지 통신으로, 서비스 요청과 응답이 완료되면 연결된 두 노드의 접속은 끊긴다.

- 캐킨(catkin) 
  - ROS 빌드 시스템이다. 기본적으로 CMake를 이용한다. ROS는 CMake를 ROS에 맞도록 특화된 캐킨 빌드 시스템을 만들었다.

## TOPIC Publisher Subscriber
![](https://velog.velcdn.com/images%2Fbbirong%2Fpost%2F14308294-d9e9-4a8e-8ec1-9ed3e066e790%2Fimage.png)

## 노드 마스터 통신 과정
![](https://t1.daumcdn.net/cfile/tistory/9946D93B5AC4529922)
![](https://244752272-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-LcW4PzQzrJVLjrT8lUh%2F-MNBQpKGmXCfslqzaQMe%2F-MNC6_ftU4n-qqFNp1ic%2FConceptual-model-of-ROS-topics-presented-by-Radu-Rusu-in-his-tutorial8.png?alt=media&token=a0de4716-9958-4d74-947c-120c78f88507)

## 토픽
- 노드는 어떻게 생성하는가?
- Topic을 게시하고 구독하는 방법
- 로봇에 카메라가 있다고 가정해 보자. 우리는 로봇 자체와 다른 랩톱에서 카메라의 이미지를 볼 수 있기를 원한다. 이 예에서는 카메라와의 통신을 처리하는 카메라 노드, 이미지 데이터를 처리하는 로봇의 이미지 처리 노드 및 이미지를 화면에 표시하는 이미지 표시 노드가 있습니다. 시작하려면 모든 노드가 마스터에 등록되어 있어야 한다. 모든 노드가 정확하게 메시지를 보낼 위치를 찾으러 가는 조회 테이블로 마스터를 생각할 수 있다.
![](http://www.clearpathrobotics.com/assets/guides/kinetic/ros/_images/ros101two.png)
- ROS 마스터에 등록할 때, 카메라 노드는 /image_data라는 Topic을 게시 할 것임을 명시한다.  (예 :). 다른 노드는 Topic /image_data에 등록된 것을 등록한다. 
- 따라서 카메라 노드가 카메라에서 일부 데이터를 수신하면 /image_data 메시지를 다른 두 노드에 직접 보낸다. (TCP/IP를 통해)
![](http://www.clearpathrobotics.com/assets/guides/kinetic/ros/_images/ros101three.png)
- 이제 이미지 처리 노드가 특정 시간에 카메라 노드에서 데이터를 요청하도록 하려면 어떻게 해야 할까? 이를 위해 ROS는 서비스(service)를 구현한다.
- 노드는 메시지를 등록하는 것처럼 특정 서비스를 ROS 마스터에 등록할 수 있다. 아래 예제에서 Image Processing Node는 먼저 /image_data를 요청(request)하고 Camera Node는 카메라에서 데이터를 수집한 다음 응답(response)을 보낸다.
